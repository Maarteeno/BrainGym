<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arcade Mental 5.0</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --primary: #5c6bc0;
            --secondary: #26a69a;
            --accent: #ef5350;
            --text: #37474f;
            --radius: 24px;
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .app {
            background: var(--card-bg);
            width: 100%;
            max-width: 500px; /* Ancho m√°ximo ideal para m√≥vil */
            min-height: 90vh;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            animation: fadeIn 0.4s ease;
            overflow-y: auto;
        }
        .screen.active { display: flex; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1, h2 { margin: 0 0 15px 0; text-align: center; color: var(--text); }
        h1 { font-size: 2rem; background: -webkit-linear-gradient(45deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* BOTONES */
        .btn {
            background: white;
            border: 1px solid rgba(0,0,0,0.05);
            color: var(--text);
            padding: 16px;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:active { transform: scale(0.97); background: #f5f5f5; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 8px 15px -5px rgba(92, 107, 192, 0.4); }
        .btn-sm { width: auto; padding: 8px 16px; font-size: 0.9rem; margin: 0; height: 36px;}
        
        .nav { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 2px solid #f0f0f0; }
        .timer { font-family: 'Courier New', monospace; font-size: 1.4rem; font-weight: bold; color: var(--primary); }

        /* --- SOPA DE LETRAS (12x12) --- */
        #sopa-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr); /* 12x12 equilibra cantidad y tama√±o */
            gap: 2px;
            background: transparent;
            width: 100%;
            aspect-ratio: 1;
            touch-action: none; 
            margin-bottom: 15px;
        }
        .cell {
            background: #f4f6f8;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            font-size: 1.1rem; /* Tama√±o legible */
            color: #546e7a;
            cursor: pointer;
            transition: background 0.1s;
        }
        @media (min-width: 400px) { .cell { font-size: 1.3rem; } } /* M√°s grande si la pantalla lo permite */

        .cell.highlight { background: var(--secondary); color: white; transform: scale(1.05); }
        .cell.found { background: var(--primary); color: white; }

        /* --- SUDOKU --- */
        #sudoku-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 1px;
            background: #333;
            border: 2px solid #333;
            margin-bottom: 15px;
            border-radius: 4px;
            overflow: hidden;
            width: 100%;
            max-width: 400px;
        }
        .sudo-cell {
            background: white;
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: #333;
        }
        .sudo-cell:nth-child(3n) { border-right: 2px solid #333; }
        .sudo-cell:nth-child(9n) { border-right: none; }
        .sudo-cell:nth-child(n+19):nth-child(-n+27),
        .sudo-cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 2px solid #333; }
        .sudo-cell.fixed { background: #e0e0e0; font-weight: bold; }
        .sudo-cell.selected { background: #bbdefb; }
        .sudo-cell.error { color: #d32f2f; background: #ffcdd2; }

        .numpad { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; width: 100%; max-width: 400px; }
        .num-btn { padding: 10px; font-size: 1.2rem; border: 1px solid #cfd8dc; background: white; border-radius: 8px; color: var(--text); }
        
        /* --- MEMORIA --- */
        #memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; width: 100%; padding: 10px 0; }
        .card {
            aspect-ratio: 1; background: var(--primary); border-radius: 10px; cursor: pointer;
            display: flex; justify-content: center; align-items: center; font-size: 2.2rem; color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s;
        }
        .card.flipped { background: white; border: 2px solid var(--primary); transform: rotateY(180deg); }
        .card-content { display: none; }
        .card.flipped .card-content { display: block; transform: rotateY(180deg); }

        /* --- RETO MATEM√ÅTICO --- */
        .math-box { background: #fff; padding: 20px; border-radius: 16px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; width: 100%; }
        .equation { font-size: 2.5rem; font-weight: bold; color: var(--text); margin-bottom: 5px; }
        .math-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; }
        .math-btn { font-size: 1.3rem; padding: 15px; }

    </style>
</head>
<body>

<div class="app">

    <div id="screen-home" class="screen active">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center; width:100%">
            <h1>üß† Brain Gym</h1>
            <p style="text-align:center; color:#78909c; margin-bottom:30px;">Gimnasio Mental 5.0</p>
            
            <button class="btn" onclick="showSopaMenu()">
                <span style="font-size:1.5rem">üî§</span> Sopa de Letras
            </button>
            <button class="btn" onclick="initSudoku()">
                <span style="font-size:1.5rem">üî¢</span> Sudoku
            </button>
            <button class="btn" onclick="initMemory()">
                <span style="font-size:1.5rem">üÉè</span> Memoria
            </button>
            <button class="btn" onclick="initMath()">
                <span style="font-size:1.5rem">üßÆ</span> C√°lculo
            </button>
        </div>
    </div>

    <div id="screen-sopa-menu" class="screen">
        <div class="nav">
            <h2>Elige Tema</h2>
            <button class="btn-sm btn" onclick="goHome()">Volver</button>
        </div>
        <div style="width:100%; display:grid; gap:8px;">
            <button class="btn" onclick="initSopa('paises')">üåç Pa√≠ses</button>
            <button class="btn" onclick="initSopa('comidas')">üçï Comidas</button>
            <button class="btn" onclick="initSopa('animales')">üê∂ Animales</button>
            <button class="btn" onclick="initSopa('profesiones')">üë®‚Äç‚öïÔ∏è Profesiones</button>
            <button class="btn" onclick="initSopa('cuerpo')">üëÉ Cuerpo Humano</button>
            <button class="btn btn-primary" onclick="initSopa('todo')">üöÄ Mix (8 a 20 palabras)</button>
        </div>
    </div>

    <div id="screen-sopa-game" class="screen">
        <div class="nav">
            <span id="sopa-cat-title" style="font-weight:bold; color:var(--primary); font-size: 0.9rem;"></span>
            <div id="sopa-timer" class="timer">00:00</div>
            <button class="btn-sm btn" onclick="stopSopa(); showSopaMenu()">‚úñ</button>
        </div>
        
        <div id="sopa-grid"></div>
        
        <div id="sopa-words" style="display:flex; flex-wrap:wrap; gap:6px; justify-content:center;"></div>
    </div>

    <div id="screen-sudoku" class="screen">
        <div class="nav">
            <h2>Sudoku</h2>
            <button class="btn-sm btn" onclick="goHome()">Salir</button>
        </div>
        <div id="sudoku-board"></div>
        <div class="numpad">
            <button class="num-btn" onclick="fillSudoku(1)">1</button>
            <button class="num-btn" onclick="fillSudoku(2)">2</button>
            <button class="num-btn" onclick="fillSudoku(3)">3</button>
            <button class="num-btn" onclick="fillSudoku(4)">4</button>
            <button class="num-btn" onclick="fillSudoku(5)">5</button>
            <button class="num-btn" onclick="fillSudoku(6)">6</button>
            <button class="num-btn" onclick="fillSudoku(7)">7</button>
            <button class="num-btn" onclick="fillSudoku(8)">8</button>
            <button class="num-btn" onclick="fillSudoku(9)">9</button>
            <button class="num-btn" style="color:var(--accent)" onclick="fillSudoku(null)">‚å´</button>
        </div>
        <div style="margin-top:20px; display:flex; gap:10px; width:100%">
            <button class="btn btn-primary" onclick="checkSudoku()">Verificar</button>
            <button class="btn" onclick="initSudoku()">Nuevo</button>
        </div>
    </div>

    <div id="screen-memory" class="screen">
        <div class="nav">
            <h2>Memoria</h2>
            <button class="btn-sm btn" onclick="goHome()">Salir</button>
        </div>
        <div id="memory-grid"></div>
    </div>

    <div id="screen-math" class="screen">
        <div class="nav">
            <h2>C√°lculo</h2>
            <button class="btn-sm btn" onclick="stopMath(); goHome()">Salir</button>
        </div>
        <div class="math-box">
            <div class="equation" id="math-eq"></div>
            <div style="font-size:1.2rem; color:var(--primary)">Puntos: <span id="math-score">0</span> | Tiempo: <span id="math-time">30</span></div>
        </div>
        <div class="math-options" id="math-opts"></div>
    </div>

</div>

<script>
    /* ================= NAVEGACI√ìN ================= */
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    function goHome() { showScreen('screen-home'); }
    function showSopaMenu() { showScreen('screen-sopa-menu'); }

    /* ================= 1. SOPA DE LETRAS PRO (DYNAMIC) ================= */
    // BASE DE DATOS EXTENDIDA (40+ Palabras por categor√≠a)
    const sopaDB = {
        paises: [
            "ARGENTINA","BOLIVIA","BRASIL","CHILE","COLOMBIA","ECUADOR","PARAGUAY","PERU","URUGUAY","VENEZUELA",
            "MEXICO","USA","CANADA","PANAMA","CUBA","ESPA√ëA","FRANCIA","ITALIA","ALEMANIA","PORTUGAL",
            "RUSIA","CHINA","JAPON","INDIA","COREA","EGIPTO","MARRUECOS","SUDAFRICA","AUSTRALIA","UEVAZELANDA",
            "SUECIA","NORUEGA","FINLANDIA","DINAMARCA","POLONIA","GRECIA","TURQUIA","ISRAEL","IRAN","IRAK",
            "VIETNAM","THAILANDIA"
        ],
        comidas: [
            "PIZZA","HAMBURGUESA","PERRITO","SANDWICH","TACOS","BURRITO","NACHOS","QUESADILLA",
            "SUSHI","SASHIMI","RAMEN","GYOZAS","ARROZ","PASTA","LASA√ëA","RAVIOLIS","MACARRONES",
            "POLLO","TERNERA","CERDO","CORDERO","PESCADO","SALMON","ATUN","GAMBAS","CALAMARES",
            "ENSALADA","SOPA","CREMA","PURE","PATATAS","HUEVOS","TORTILLA","PAN","QUESO","JAMON",
            "CHOCOLATE","HELADO","TARTA","FRUTA","MANZANA","PLATANO"
        ],
        animales: [
            "PERRO","GATO","HAMSTER","CONEJO","PAJARO","PEZ","TORTUGA","LORO","CANARIO",
            "LEON","TIGRE","ELEFANTE","JIRAFA","ZEBRA","HIPOPOTAMO","RINOCERONTE","MONO","GORILA",
            "OSO","PANDA","POLAR","LOBO","ZORRO","CIERVO","JABALI","CABALLO","VACA","OVEJA",
            "CERDO","GALLINA","PATO","AGUILA","BUHO","HALCON","DELFIN","BALLENA","TIBURON",
            "PULPO","CANGREJO","SERPIENTE","COCODRILO","RANA"
        ],
        profesiones: [
            "MEDICO","ENFERMERO","CIRUJANO","DENTISTA","VETERINARIO","PSICOLOGO",
            "PROFESOR","MAESTRO","DIRECTOR","ESTUDIANTE","CIENTIFICO","INVESTIGADOR",
            "INGENIERO","ARQUITECTO","ALBA√ëIL","FONTANERO","ELECTRICISTA","CARPINTERO","PINTOR",
            "POLICIA","BOMBERO","MILITAR","PILOTO","AZAFATA","CONDUCTOR","TAXISTA","CAMIONERO",
            "ABOGADO","JUEZ","POLITICO","PERIODISTA","ESCRITOR","MUSICO","ACTOR","CANTANTE",
            "PINTOR","ARTISTA","COCINERO","CAMARERO","PANADERO"
        ],
        cuerpo: [
            "CABEZA","CARA","PELO","OJOS","NARIZ","BOCA","DIENTES","LENGUA","OREJAS",
            "CUELLO","HOMBRO","BRAZO","CODO","MANO","DEDOS","U√ëAS","PECHO","ESPALDA",
            "BARRIGA","CINTURA","CADERA","PIERNA","RODILLA","TOBILLO","PIE","TALON",
            "CORAZON","PULMON","ESTOMAGO","HIGADO","RI√ëON","INTESTINO","HUESO","MUSCULO",
            "SANGRE","PIEL","CEREBRO","NERVIO","VENA","ARTERIA"
        ],
        todo: []
    };
    // Generar 'todo' din√°micamente
    sopaDB.todo = [].concat(...Object.values(sopaDB));

    let sGridSize = 12; // Grid 12x12
    let sMatrix = [], sWords = [], sFound = [];
    let sTimerInterval, sSeconds = 0, sTimerStarted = false;
    let isSwiping = false, swipeStart = null, currentHighlight = [];

    function initSopa(cat) {
        showScreen('screen-sopa-game');
        document.getElementById('sopa-cat-title').textContent = cat.toUpperCase();
        
        clearInterval(sTimerInterval);
        sSeconds = 0; sTimerStarted = false;
        document.getElementById('sopa-timer').textContent = "00:00";

        // --- L√ìGICA DE DENSIDAD DIN√ÅMICA ---
        // 1. Obtener lista completa y barajar
        let fullList = sopaDB[cat].sort(() => Math.random() - 0.5);
        
        // 2. Elegir cantidad aleatoria entre 8 y 20
        let minWords = 8;
        let maxWords = 20;
        let count = Math.floor(Math.random() * (maxWords - minWords + 1)) + minWords;
        
        // 3. Seleccionar palabras (cortar array)
        sWords = fullList.slice(0, count);
        sFound = [];

        generateSopaGrid();
        renderSopa();
    }

    function startSopaTimer() {
        if(sTimerStarted) return;
        sTimerStarted = true;
        sTimerInterval = setInterval(() => {
            sSeconds++;
            let m = Math.floor(sSeconds/60).toString().padStart(2,'0');
            let s = (sSeconds%60).toString().padStart(2,'0');
            document.getElementById('sopa-timer').textContent = `${m}:${s}`;
        }, 1000);
    }
    function stopSopa() { clearInterval(sTimerInterval); }

    function generateSopaGrid() {
        sMatrix = Array(sGridSize).fill().map(() => Array(sGridSize).fill(''));
        let wordsPlaced = [];

        // Intentar colocar las palabras seleccionadas
        for(let word of sWords) {
            // Filtrar palabras muy largas si la grilla es peque√±a (opcional, pero seguro)
            if(word.length > sGridSize) continue;

            let placed = false, attempts = 0;
            while(!placed && attempts++ < 150) {
                let dir = Math.floor(Math.random()*3); // 0:H, 1:V, 2:D
                let r = Math.floor(Math.random()*sGridSize);
                let c = Math.floor(Math.random()*sGridSize);
                if(checkFit(word, r, c, dir)) {
                    for(let i=0; i<word.length; i++) {
                        let nr = r + (dir===1||dir===2 ? i : 0);
                        let nc = c + (dir===0||dir===2 ? i : 0);
                        sMatrix[nr][nc] = word[i];
                    }
                    placed = true;
                    wordsPlaced.push(word);
                }
            }
        }
        // Actualizar lista de palabras a las que REALMENTE cupieron (por si alguna falla)
        sWords = wordsPlaced;

        // Rellenar huecos
        const abc = "ABCDEFGHIJKLMN√ëOPQRSTUVWXYZ";
        for(let r=0; r<sGridSize; r++) for(let c=0; c<sGridSize; c++)
            if(!sMatrix[r][c]) sMatrix[r][c] = abc[Math.floor(Math.random()*abc.length)];
    }

    function checkFit(w, r, c, dir) {
        let len = w.length;
        let er = r + (dir===1||dir===2 ? len-1 : 0);
        let ec = c + (dir===0||dir===2 ? len-1 : 0);
        if(er >= sGridSize || ec >= sGridSize) return false;
        for(let i=0; i<len; i++) {
            let nr = r + (dir===1||dir===2 ? i : 0);
            let nc = c + (dir===0||dir===2 ? i : 0);
            if(sMatrix[nr][nc] !== '' && sMatrix[nr][nc] !== w[i]) return false;
        }
        return true;
    }

    function renderSopa() {
        const grid = document.getElementById('sopa-grid');
        grid.innerHTML = '';
        for(let r=0; r<sGridSize; r++) {
            for(let c=0; c<sGridSize; c++) {
                let d = document.createElement('div');
                d.className = 'cell';
                d.textContent = sMatrix[r][c];
                d.dataset.r = r; d.dataset.c = c;
                d.onmousedown = handleStart; d.onmouseenter = handleMove; d.onmouseup = handleEnd;
                d.ontouchstart = (e) => { e.preventDefault(); handleStart.call(d); };
                grid.appendChild(d);
            }
        }
        grid.ontouchmove = (e) => {
            e.preventDefault();
            let el = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
            if(el && el.classList.contains('cell')) handleMove.call(el);
        };
        grid.ontouchend = handleEnd;

        const list = document.getElementById('sopa-words');
        list.innerHTML = '';
        sWords.forEach(w => {
            let sp = document.createElement('span');
            sp.id = 'w-'+w; sp.textContent = w;
            sp.style.padding="3px 6px"; sp.style.background="#eceff1"; sp.style.borderRadius="4px"; sp.style.fontSize="0.75rem";
            list.appendChild(sp);
        });
    }

    function handleStart() { startSopaTimer(); isSwiping=true; swipeStart=this; highlightCells(this); }
    function handleMove() { if(isSwiping && swipeStart) highlightCells(this); }
    function highlightCells(end) {
        currentHighlight.forEach(c => c.classList.remove('highlight'));
        currentHighlight = [];
        let r1 = +swipeStart.dataset.r, c1 = +swipeStart.dataset.c;
        let r2 = +end.dataset.r, c2 = +end.dataset.c;
        let dr = r2-r1, dc = c2-c1;
        let steps = Math.max(Math.abs(dr), Math.abs(dc));
        if(dr!==0 && dc!==0 && Math.abs(dr)!==Math.abs(dc)) return;
        
        for(let i=0; i<=steps; i++) {
            let nr = r1 + (dr===0?0:dr/steps)*i, nc = c1 + (dc===0?0:dc/steps)*i;
            let cell = document.querySelector(`.cell[data-r="${nr}"][data-c="${nc}"]`);
            if(cell) { cell.classList.add('highlight'); currentHighlight.push(cell); }
        }
    }
    function handleEnd() {
        if(!isSwiping) return;
        isSwiping = false;
        let word = currentHighlight.map(c => c.textContent).join('');
        let rev = word.split('').reverse().join('');
        let match = null;
        if(sWords.includes(word) && !sFound.includes(word)) match = word;
        else if(sWords.includes(rev) && !sFound.includes(rev)) match = rev;

        if(match) {
            sFound.push(match);
            currentHighlight.forEach(c => { c.classList.remove('highlight'); c.classList.add('found'); });
            let wEl = document.getElementById('w-'+match);
            if(wEl) {
                wEl.style.background = "var(--primary)"; wEl.style.color = "white"; wEl.style.textDecoration = "line-through";
            }
            if(sFound.length === sWords.length) { setTimeout(() => alert("¬°Ganaste!"), 100); stopSopa(); }
        } else {
            currentHighlight.forEach(c => c.classList.remove('highlight'));
        }
        currentHighlight = []; swipeStart = null;
    }

    /* ================= 2. SUDOKU ================= */
    let sudoSol = [], sudoPuz = [], selSudo = null;
    function initSudoku() {
        showScreen('screen-sudoku');
        let base = [[1,2,3,4,5,6,7,8,9],[4,5,6,7,8,9,1,2,3],[7,8,9,1,2,3,4,5,6],[2,3,4,5,6,7,8,9,1],[5,6,7,8,9,1,2,3,4],[8,9,1,2,3,4,5,6,7],[3,4,5,6,7,8,9,1,2],[6,7,8,9,1,2,3,4,5],[9,1,2,3,4,5,6,7,8]];
        let map = [1,2,3,4,5,6,7,8,9].sort(()=>Math.random()-0.5);
        sudoSol = base.map(row => row.map(n => map[n-1]));
        sudoPuz = sudoSol.map(r => [...r]);
        let holes = 40;
        while(holes>0) { let r=Math.floor(Math.random()*9), c=Math.floor(Math.random()*9); if(sudoPuz[r][c]!==0){ sudoPuz[r][c]=0; holes--; } }
        
        const b = document.getElementById('sudoku-board'); b.innerHTML = ''; selSudo = null;
        for(let i=0; i<81; i++) {
            let d = document.createElement('div'); d.className = 'sudo-cell';
            let r=Math.floor(i/9), c=i%9;
            if(sudoPuz[r][c]!==0) { d.textContent=sudoPuz[r][c]; d.classList.add('fixed'); }
            else d.onclick = () => { if(selSudo) selSudo.classList.remove('selected'); selSudo=d; d.classList.add('selected'); };
            b.appendChild(d);
        }
    }
    function fillSudoku(n) { if(selSudo) { selSudo.textContent = n?n:''; selSudo.classList.remove('error'); } }
    function checkSudoku() {
        let err=0, mt=0, cells=document.querySelectorAll('.sudo-cell');
        cells.forEach((d,i) => {
            let val = parseInt(d.textContent)||0;
            if(val===0) mt++;
            else if(val !== sudoSol[Math.floor(i/9)][i%9] && !d.classList.contains('fixed')) { d.classList.add('error'); err++; }
        });
        alert(err===0 && mt===0 ? "¬°Correcto!" : `Errores: ${err}, Vac√≠os: ${mt}`);
    }

    /* ================= 3. MEMORIA ================= */
    const memoThemes = [
        ["üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº"],
        ["‚öΩ","üèÄ","üèà","üéæ","üé±","üé≥","‚õ≥","ü•ä"],
        ["üçè","üçî","üçï","üç™","üåÆ","üç¶","üç©","üçü"],
        ["üòÄ","üòé","üòç","ü§î","üò¥","ü§¢","ü§°","üëª"]
    ];
    let flipCards = [], lock = false;

    function initMemory() {
        showScreen('screen-memory');
        const grid = document.getElementById('memory-grid'); grid.innerHTML=''; flipCards=[]; lock=false;
        let theme = memoThemes[Math.floor(Math.random()*memoThemes.length)];
        let deck = [...theme, ...theme].sort(()=>Math.random()-0.5);
        deck.forEach(icon => {
            let c = document.createElement('div'); c.className = 'card';
            c.innerHTML = `<div class="card-content">${icon}</div>`;
            c.onclick = () => {
                if(lock || c.classList.contains('flipped')) return;
                c.classList.add('flipped'); flipCards.push({c, icon});
                if(flipCards.length===2) {
                    lock=true;
                    if(flipCards[0].icon === flipCards[1].icon) { flipCards=[]; lock=false; if(!document.querySelectorAll('.card:not(.flipped)').length) setTimeout(()=>alert("¬°Ganaste!"),500); }
                    else setTimeout(() => { flipCards[0].c.classList.remove('flipped'); flipCards[1].c.classList.remove('flipped'); flipCards=[]; lock=false; }, 1000);
                }
            };
            grid.appendChild(c);
        });
    }

    /* ================= 4. MATEM√ÅTICAS ================= */
    let mathScore = 0, mathTime = 30, mathInterval, currentAns = 0;
    function initMath() {
        showScreen('screen-math'); mathScore = 0; mathTime = 30;
        document.getElementById('math-score').textContent = "0"; document.getElementById('math-time').textContent = "30";
        newMathQ();
        mathInterval = setInterval(() => {
            mathTime--; document.getElementById('math-time').textContent = mathTime;
            if(mathTime <= 0) { clearInterval(mathInterval); alert(`¬°Tiempo! Puntos: ${mathScore}`); goHome(); }
        }, 1000);
    }
    function stopMath() { clearInterval(mathInterval); }
    function newMathQ() {
        let op = Math.random() < 0.5 ? '+' : (Math.random()<0.5 ? '-' : '*');
        let a = Math.floor(Math.random()*12)+1, b = Math.floor(Math.random()*12)+1;
        if(op === '*') { a = Math.floor(Math.random()*9)+1; b = Math.floor(Math.random()*9)+1; }
        currentAns = eval(`${a} ${op} ${b}`);
        document.getElementById('math-eq').textContent = `${a} ${op} ${b}`;
        let opts = [currentAns];
        while(opts.length < 4) { let fake = currentAns + Math.floor(Math.random()*10) - 5; if(fake !== currentAns && !opts.includes(fake) && fake > 0) opts.push(fake); }
        opts.sort(() => Math.random() - 0.5);
        let c = document.getElementById('math-opts'); c.innerHTML = '';
        opts.forEach(o => {
            let btn = document.createElement('button'); btn.className = 'btn btn-primary math-btn'; btn.textContent = o;
            btn.onclick = () => {
                if(o === currentAns) { mathScore += 10; document.getElementById('math-score').textContent = mathScore; btn.style.background = "#4caf50"; setTimeout(newMathQ, 200); }
                else { mathScore = Math.max(0, mathScore - 5); document.getElementById('math-score').textContent = mathScore; btn.style.background = "#ef5350"; }
            };
            c.appendChild(btn);
        });
    }
</script>
</body>
</html>
